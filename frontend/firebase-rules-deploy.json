{
  "rules": {
    "sessions": {
      "$sessionCode": {
        ".read": true,
        ".write": true,
        "studentsJoined": {
          ".indexOn": ["joinedAt"]
        },
        "studentProgress": {
          ".indexOn": ["status"]
        }
      }
    },
    "session-logs": {
      "$sessionCode": {
        "$studentId": {
          ".read": "auth != null",
          ".write": true,
          ".indexOn": ["timestamp", "type"],
          "$logId": {
            ".validate": "newData.hasChildren(['type', 'timestamp']) && newData.child('type').isString() && newData.child('type').val().length < 50 && newData.child('timestamp').isNumber()"
          }
        }
      }
    },
    "all-problems": {
      ".read": "auth != null",
      ".write": true,
      ".indexOn": ["timestamp", "date", "type", "sessionCode", "resolved"],
      "$problemId": {
        ".validate": "newData.hasChildren(['type', 'timestamp']) && newData.child('type').isString() && newData.child('type').val().length < 50 && newData.child('timestamp').isNumber()"
      }
    },
    "compositions": {
      "$shareCode": {
        ".read": true,
        ".write": true
      }
    },
    "partnerGames": {
      "$code": {
        ".read": true,
        ".write": true
      }
    },
    "reflections": {
      "$sessionCode": {
        "$studentId": {
          ".read": true,
          ".write": true
        }
      }
    },
    "approvedEmails": {
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.email == 'robtaube90@gmail.com' || auth.token.email == 'robtaube92@gmail.com')"
    },
    "users": {
      ".read": "auth != null && (auth.token.email == 'robtaube90@gmail.com' || auth.token.email == 'robtaube92@gmail.com')",
      ".write": "auth != null && (auth.token.email == 'robtaube90@gmail.com' || auth.token.email == 'robtaube92@gmail.com')",
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "teacherClasses": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "teacherAnalytics": {
      ".read": "auth != null && (auth.token.email == 'robtaube90@gmail.com' || auth.token.email == 'robtaube92@gmail.com')",
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "pilotSessions": {
      ".read": "auth != null",
      ".write": "auth != null"
    },
    "teacherOutreach": {
      ".read": "auth != null && (auth.token.email == 'robtaube90@gmail.com' || auth.token.email == 'robtaube92@gmail.com')",
      ".write": "auth != null && (auth.token.email == 'robtaube90@gmail.com' || auth.token.email == 'robtaube92@gmail.com')"
    },
    "teachers": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "students": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "classes": {
      "$classId": {
        ".read": true,
        ".write": "auth != null && (!data.exists() || data.child('teacherUid').val() == auth.uid)",
        "currentSession": {
          "studentsJoined": {
            "$seatId": {
              ".write": true
            }
          },
          "studentProgress": {
            "$seatId": {
              ".write": true
            }
          }
        }
      }
    },
    "classCodes": {
      "$code": {
        ".read": true,
        ".write": "auth != null"
      }
    },
    "usernames": {
      "$username": {
        ".read": true,
        ".write": "auth != null"
      }
    },
    "classRosters": {
      "$classId": {
        ".read": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        "$seatNumber": {
          ".read": true
        }
      }
    },
    "pinHashes": {
      "$classId": {
        ".read": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        "$seatNumber": {
          ".read": true,
          ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid"
        }
      }
    },
    "pinLoginAttempts": {
      "$classId": {
        ".read": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        "$seatNumber": {
          ".read": true,
          ".write": true
        }
      }
    },
    "studentEnrollments": {
      "$studentUid": {
        ".read": "auth != null && auth.uid == $studentUid",
        ".write": "auth != null && (auth.uid == $studentUid || root.child('teachers').child(auth.uid).exists())"
      }
    },
    "studentWork": {
      "$studentUid": {
        ".read": "auth != null && (auth.uid == $studentUid || root.child('teachers').child(auth.uid).exists())",
        ".write": "auth != null && (auth.uid == $studentUid || root.child('teachers').child(auth.uid).exists())",
        "$activityId": {
          ".read": true,
          ".write": true
        }
      }
    },
    "submissions": {
      "$classId": {
        ".read": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        "$lessonId": {
          "$studentUid": {
            ".read": true,
            ".write": true
          }
        }
      }
    },
    "rubrics": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "answerKeys": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "grades": {
      "$classId": {
        ".read": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid",
        "$studentUid": {
          ".read": true
        }
      }
    },
    "conductedLessons": {
      "$classId": {
        ".read": true,
        ".write": "auth != null && root.child('classes').child($classId).child('teacherUid').val() == auth.uid"
      }
    }
  }
}
